<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Key Climate Variables Radar Chart</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #f8f9fa; text-align: center; padding: 20px; }
    h1 { margin-bottom: 0.5em; }
    svg { background: white; margin: auto; display: block; border: 1px solid #ccc; }
    .axisLabel { font-size: 12px; fill: #333; }
    .tooltip {
      position: absolute; background: rgba(0,0,0,0.8); color: white;
      padding: 6px 8px; border-radius: 4px; pointer-events: none;
      font-size: 12px; opacity: 0; transition: opacity 0.2s;
    }
  </style>
</head>
<body>
  <h1>Climate Radar: Key Variables</h1>
  <svg id="radar" width="600" height="600"></svg>
  <div id="tooltip" class="tooltip"></div>

  <script>
    const CSV_URL = "https://gist.githubusercontent.com/mas5021/546c5cb1aaaaed863bb098b86f71503e/raw/1897725dabe21080a628a0022fa79942c48e1483/merged_climate.csv";

    // The seven variables to plot:
    const vars = [
      { key: "Avg_Temp (Â°C)", label: "Avg Temp (°C)" },
      { key: "Precipitation (mm)", label: "Precipitation (mm)" },
      { key: "Humidity (%)", label: "Humidity (%)" },
      { key: "Wind_Speed (m/s)", label: "Wind Speed (m/s)" },
      { key: "Solar_Irradiance (W/mÂ²)", label: "Solar Irradiance" },
      { key: "Cloud_Cover (%)", label: "Cloud Cover (%)" },
      { key: "Vegetation_Index", label: "Vegetation Index" }
    ];

    const svg = d3.select("#radar"),
          width = +svg.attr("width"),
          height = +svg.attr("height"),
          radius = Math.min(width, height) / 2 - 60;

    const g = svg.append("g")
                 .attr("transform", `translate(${width/2},${height/2})`);

    const tooltip = d3.select("#tooltip");

    d3.csv(CSV_URL, d => {
      // parse numeric columns
      const out = {};
      vars.forEach(v => out[v.key] = +d[v.key]);
      return out;
    }).then(data => {
      // filter valid rows
      data = data.filter(d => vars.every(v => !isNaN(d[v.key])));
      if(!data.length) return console.error("No valid data");

      // compute avg, extent, normalize
      const stats = vars.map(v => {
        const vals = data.map(d => d[v.key]);
        const avg = d3.mean(vals);
        const [min, max] = d3.extent(vals);
        return { 
          key: v.key,
          label: v.label,
          avg, norm: (avg - min)/(max - min) 
        };
      });

      // scales
      const angle = d3.scalePoint()
                      .domain(stats.map(d=>d.key))
                      .range([0,2*Math.PI]);
      const rScale = d3.scaleLinear().domain([0,1]).range([0,radius]);

      // draw concentric circles
      [0.25,0.5,0.75,1].forEach(t => {
        g.append("circle")
         .attr("r", rScale(t))
         .attr("fill","none")
         .attr("stroke","#ccc")
         .attr("stroke-dasharray","3,3");
      });

      // axes & labels
      stats.forEach(d => {
        const a = angle(d.key) - Math.PI/2;
        const x = Math.cos(a)*radius,
              y = Math.sin(a)*radius;
        g.append("line")
         .attr("x1",0).attr("y1",0)
         .attr("x2",x).attr("y2",y)
         .attr("stroke","#ccc");
        g.append("text")
         .attr("x",Math.cos(a)*(radius+20))
         .attr("y",Math.sin(a)*(radius+20))
         .attr("text-anchor","middle")
         .attr("class","axisLabel")
         .text(d.label)
         .on("mouseover", e=>{
           tooltip.style("opacity",1)
                  .html(`${d.label}: ${d.avg.toFixed(2)}`)
                  .style("left", (e.pageX+10)+"px")
                  .style("top", (e.pageY-20)+"px");
         })
         .on("mouseout",()=>tooltip.style("opacity",0));
      });

      // radar line
      const line = d3.lineRadial()
                     .angle(d=>angle(d.key))
                     .radius(d=>rScale(d.norm))
                     .curve(d3.curveLinearClosed);

      g.append("path")
       .datum(stats)
       .attr("d", line)
       .attr("fill","#2980b9")
       .attr("fill-opacity",0.4)
       .attr("stroke","#2980b9")
       .attr("stroke-width",2)
       .on("mouseover", e=>{
         tooltip.style("opacity",1)
                .html(stats.map(d=>`${d.label}: ${d.avg.toFixed(2)}`).join("<br>"))
                .style("left",(e.pageX+10)+"px")
                .style("top",(e.pageY-20)+"px");
       })
       .on("mouseout",()=>tooltip.style("opacity",0));

      // vertices
      g.selectAll(".vtx")
       .data(stats)
       .enter().append("circle")
       .attr("class","vtx")
       .attr("r",4)
       .attr("cx",d=>Math.cos(angle(d.key)-Math.PI/2)*rScale(d.norm))
       .attr("cy",d=>Math.sin(angle(d.key)-Math.PI/2)*rScale(d.norm))
       .attr("fill","#fff")
       .attr("stroke","#2980b9")
       .on("mouseover",(e,d)=>{
         tooltip.style("opacity",1)
                .html(`${d.label}: ${d.avg.toFixed(2)}`)
                .style("left",(e.pageX+10)+"px")
                .style("top",(e.pageY-20)+"px");
       })
       .on("mouseout",()=>tooltip.style("opacity",0));

    }).catch(console.error);
  </script>
</body>
</html>
